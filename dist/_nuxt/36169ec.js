(window.webpackJsonp=window.webpackJsonp||[]).push([[42],{584:function(t,e,n){var content=n(613);content.__esModule&&(content=content.default),"string"==typeof content&&(content=[[t.i,content,""]]),content.locals&&(t.exports=content.locals);(0,n(7).default)("b3f0d6f2",content,!0,{sourceMap:!1})},612:function(t,e,n){"use strict";n(584)},613:function(t,e,n){var r=n(6)((function(i){return i[1]}));r.push([t.i,".pagination-select,.search-input{width:200px}.el-table th.el-table__cell{background-color:transparent}.white-content .el-table th.el-table__cell{background-color:#fff}.el-table td.el-table__cell,.el-table th.el-table__cell.is-leaf{border-bottom:none}",""]),r.locals={},t.exports=r},631:function(t,e,n){"use strict";n.r(e);var r,o=n(4),c=n(5),l=(n(575),n(64),n(576)),h=n.n(l),d=(n(251),n(127)),f=n.n(d),m=(n(578),n(579)),v=n.n(m),_=(n(422),n(423)),w=n.n(_),y=(n(424),n(425)),x=n.n(y),D=(n(426),n(427)),$=n.n(D),k=(n(18),n(8),n(13),n(164),n(126),n(41)),C=n(611),W=n(56),T=n.n(W),O={name:"display-transactions",components:(r={BasePagination:k.c},Object(c.a)(r,$.a.name,$.a),Object(c.a)(r,x.a.name,x.a),Object(c.a)(r,w.a.name,w.a),Object(c.a)(r,v.a.name,v.a),Object(c.a)(r,f.a.name,f.a),Object(c.a)(r,h.a.name,h.a),r),computed:{queriedData:function(){if(this.$isEmpty(this.tableData))return null;var t=this.tableData;return this.searchedData.length>0&&(t=this.searchedData),t.slice(this.from,this.to)},to:function(){var t=this.from+this.pagination.perPage;return this.total<t&&(t=this.total),t},from:function(){return this.pagination.perPage*(this.pagination.currentPage-1)},total:function(){return this.searchedData.length>0?this.searchedData.length:this.tableData.length}},data:function(){return{pagination:{perPage:50,currentPage:1,perPageOptions:[5,10,25,50],total:0},searchQuery:"",propsToSearch:["description","creation_date","category_id","tags"],tableColumns:[{prop:"description",label:this.$nuxt.$t("transaction.get.description"),minWidth:200}],tableData:[],searchedData:[],fuseSearch:null,startsWithDate:null,endsWithDate:null,currency:null,categories:[],transactions:null,searchWithDates:"",transactionTabs:[{name:"Transactions",icon:"tim-icons icon-tap-02"},{name:"Category",icon:"tim-icons icon-gift-2"},{name:"Tabs",icon:"tim-icons icon-single-02"}],activeIndex:0}},methods:{searchTransaction:function(){var t=this;return Object(o.a)(regeneratorRuntime.mark((function e(){var n;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=new Date(t.searchWithDates),!isNaN(n)){e.next=4;break}return t.$notify({type:"danger",icon:"tim-icons icon-simple-remove",verticalAlign:"bottom",horizontalAlign:"center",message:t.$nuxt.$t("transaction.get.validDate")}),e.abrupt("return");case 4:return t.setStartsWithDate(n),t.setEndsWithDate(n),e.next=8,t.filterTransactions();case 8:case"end":return e.stop()}}),e)})))()},setEndsWithDate:function(t){var e=new Date(Date.UTC(t.getFullYear(),t.getMonth()+1,0));this.endsWithDate=e.toISOString().substring(0,10)},setStartsWithDate:function(t){var e=new Date(Date.UTC(t.getFullYear(),t.getMonth(),1));this.startsWithDate=e.toISOString().substring(0,10)},filterTransactions:function(){var t=this;return Object(o.a)(regeneratorRuntime.mark((function e(){var n;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.$wallet.setCurrentWallet(t);case 2:return n=e.sent,e.next=5,t.$axios.$post("/transactions",{wallet_id:n.WalletId,starts_with_date:t.startsWithDate,ends_with_date:t.endsWithDate}).then((function(e){t.transactions=e,t.calculateCategories(t.categories)})).catch((function(e){t.$notify({type:"danger",icon:"tim-icons icon-simple-remove",verticalAlign:"bottom",horizontalAlign:"center",message:e})}));case 5:case"end":return e.stop()}}),e)})))()},getTransactions:function(t){var e=this;return Object(o.a)(regeneratorRuntime.mark((function n(){return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,e.$axios.$post("/transactions",{wallet_id:t,starts_with_date:e.startsWithDate,ends_with_date:e.endsWithDate}).then((function(t){e.transactions=t,e.fetchCategoryLink()})).catch((function(t){e.$notify({type:"danger",icon:"tim-icons icon-simple-remove",verticalAlign:"bottom",horizontalAlign:"center",message:t})}));case 2:case"end":return n.stop()}}),n)})))()},calculateAmount:function(t){return this.$n(t)+this.currency},handleDelete:function(t){var e=this;T.a.fire({title:this.$nuxt.$t("transaction.delete.confirm"),text:this.$nuxt.$t("transaction.delete.confirmationText"),type:"warning",showCancelButton:!0,confirmButtonClass:"btn btn-success btn-fill",cancelButtonClass:"btn btn-danger btn-fill",confirmButtonText:this.$nuxt.$t("transaction.delete.button"),buttonsStyling:!1}).then(function(){var n=Object(o.a)(regeneratorRuntime.mark((function n(r){return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(!r.value){n.next=3;break}return n.next=3,e.deleteItem(t);case 3:case"end":return n.stop()}}),n)})));return function(t){return n.apply(this,arguments)}}())},deleteItem:function(t){var e=this;return Object(o.a)(regeneratorRuntime.mark((function n(){var r;return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,e.$wallet.setCurrentWallet(e);case 2:return r=n.sent,n.next=5,e.$axios.$post("/delete-item",{pk:r.WalletId,sk:t.sk}).then(Object(o.a)(regeneratorRuntime.mark((function n(){var r;return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:e.deleteRow(t),r=e.$nuxt.$t("transaction.delete.success.description"),e.$notify({type:"success",icon:"tim-icons icon-check-2",verticalAlign:"bottom",horizontalAlign:"center",message:r+"".concat(t.description)});case 3:case"end":return n.stop()}}),n)})))).catch((function(t){e.$notify({type:"danger",icon:"tim-icons icon-simple-remove",verticalAlign:"bottom",horizontalAlign:"center",message:t}),e.closeModal()}));case 5:case"end":return n.stop()}}),n)})))()},deleteRow:function(t){var e=this.tableData.findIndex((function(e){return e.id===t.id}));e>=0&&this.tableData.splice(e,1)},setDatesToFetchTransaction:function(){var t=new Date;this.setStartsWithDate(t),this.setEndsWithDate(t)},getCategories:function(t){var e=this;return Object(o.a)(regeneratorRuntime.mark((function n(){return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,e.$axios.$post("/categories",{user_id:t}).then((function(t){e.calculateCategories(t)})).catch((function(t){var n=e.$lastElement(e.$splitElement(t.data.message,":"));e.$notify({type:"danger",icon:"tim-icons icon-simple-remove",verticalAlign:"bottom",horizontalAlign:"center",message:n})}));case 2:case"end":return n.stop()}}),n)})))()},calculateCategories:function(t){this.categories=t,this.assignCategoriesToTransactions(t),this.tableData=this.transactions,this.initializeFuseSearch()},assignCategoriesToTransactions:function(t){if(!this.$isEmpty(t))for(var i=0,e=t.length;i<e;i++){var n=t[i];if(!this.$isEmpty(this.transactions))for(var r=0,o=this.transactions.length;r<o;r++){var c=this.transactions[r];c.category_id===n.sk&&(c.categoryName=n.category_type+" : "+n.category_name)}}},fetchCategoryLink:function(){var t=this;return Object(o.a)(regeneratorRuntime.mark((function e(){var n;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.$authentication.fetchCurrentUser(t).financialPortfolioId,e.next=3,t.getCategories(n);case 3:case"end":return e.stop()}}),e)})))()},initializeFuseSearch:function(){this.fuseSearch=new C.a(this.tableData,{keys:[{name:"description",weight:3},{name:"tags",weight:1}],threshold:.3})}},mounted:function(){var t=this;return Object(o.a)(regeneratorRuntime.mark((function e(){var n;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t.setDatesToFetchTransaction(),e.next=3,t.$wallet.setCurrentWallet(t);case 3:return n=e.sent,e.next=6,t.getTransactions(n.WalletId);case 6:t.currency=n.WalletCurrency;case 7:case"end":return e.stop()}}),e)})))()},watch:{searchQuery:function(t){var e=this.tableData;if(""!==t){var n=this.fuseSearch.search(this.searchQuery);e=[];for(var i=0,r=n.length;i<r;i++){var o=n[i].item;e.push(o)}}this.searchedData=e}}},j=O,S=(n(612),n(2)),component=Object(S.a)(j,(function(){var t=this,e=t._self._c;return e("div",[e("div",{staticClass:"row"},[e("div",{staticClass:"col-12"},[e("card",[e("h4",{staticClass:"card-title",attrs:{slot:"header"},slot:"header"},[t._v(t._s(t.$t("transaction.get.filter")))]),t._v(" "),e("base-input",[e("el-date-picker",{attrs:{type:"month",placeholder:t.startsWithDate},model:{value:t.searchWithDates,callback:function(e){t.searchWithDates=e},expression:"searchWithDates"}})],1),t._v(" "),e("base-button",{staticClass:"btn btn-primary pull-right",nativeOn:{click:function(e){return t.searchTransaction.apply(null,arguments)}}},[t._v("\n                    "+t._s(t.$t("transaction.get.search"))+"\n                ")])],1)],1)]),t._v(" "),e("card",{attrs:{"card-body-classes":"table-full-width"}},[e("div",{staticClass:"row"},[e("div",{staticClass:"col-6"},[e("h4",{staticClass:"card-title",attrs:{slot:"header"},slot:"header"},[t._v(t._s(t.$t("transaction.get.title")))])]),t._v(" "),e("div",{staticClass:"col-6"},[e("nuxt-link",{staticClass:"btn btn-primary pull-right",attrs:{to:"/transaction/add"}},[t._v("\n                    "+t._s(t.$t("transaction.get.add-button"))+"\n                ")])],1)]),t._v(" "),e("div",[e("div",{staticClass:"col-12 d-flex justify-content-center justify-content-sm-between flex-wrap"},[e("base-input",[e("el-input",{staticClass:"mb-3 search-input",attrs:{type:"search",clearable:"","prefix-icon":"el-icon-search",placeholder:t.$t("transaction.get.search-records"),"aria-controls":"datatables"},model:{value:t.searchQuery,callback:function(e){t.searchQuery=e},expression:"searchQuery"}})],1)],1),t._v(" "),e("el-table",{attrs:{data:t.queriedData}},[e("el-table-column",{attrs:{"min-width":135,label:t.$t("transaction.get.creation_date"),sortable:"",prop:"creationDate"},scopedSlots:t._u([{key:"default",fn:function(n){return e("div",{},[t._v("\n                        "+t._s(new Date(n.row.creation_date).toLocaleDateString(t.$i18n.locale,{year:"numeric",month:"long",day:"numeric",hour:"numeric",minute:"numeric"}))+"\n                    ")])}}])}),t._v(" "),e("el-table-column",{attrs:{"min-width":100,label:t.$t("transaction.get.amount"),sortable:"",prop:"amount"},scopedSlots:t._u([{key:"default",fn:function(n){return e("div",{},[t._v("\n                        "+t._s(t.calculateAmount(n.row.amount))+"\n                    ")])}}])}),t._v(" "),e("el-table-column",{attrs:{"min-width":100,label:t.$t("transaction.get.category"),sortable:"",prop:"category"},scopedSlots:t._u([{key:"default",fn:function(n){return e("div",{},[e("nuxt-link",{attrs:{to:{path:"/budgets#"+n.row.category_id}}},[e("p",[t._v(t._s(n.row.categoryName))])])],1)}}])}),t._v(" "),t._l(t.tableColumns,(function(t){return e("el-table-column",{key:t.label,attrs:{"min-width":t.minWidth,prop:t.prop,label:t.label}})})),t._v(" "),e("el-table-column",{attrs:{"min-width":100,label:t.$t("transaction.get.tags")},scopedSlots:t._u([{key:"default",fn:function(n){return e("div",{},t._l(n.row.tags,(function(n){return e("span",{key:n},[e("el-tag",{attrs:{size:"small",type:"info"}},[t._v(t._s(n)+"\n                            ")])],1)})),0)}}])}),t._v(" "),e("el-table-column",{attrs:{"min-width":100,align:"right",label:t.$t("transaction.get.actions")},scopedSlots:t._u([{key:"default",fn:function(n){return e("div",{},[e("el-tooltip",{attrs:{content:t.$t("transaction.get.link"),effect:"light","open-delay":300,placement:"top"}},[e("nuxt-link",{staticClass:"edit btn-link btn-neutral",attrs:{to:{path:"/transaction/transaction-link",query:{transaction_description:n.row.description,transaction_amount:n.row.amount}},type:"info",size:"sm",icon:""}},[e("i",{staticClass:"tim-icons icon-link-72"})])],1),t._v(" "),e("el-tooltip",{attrs:{content:t.$t("transaction.get.edit"),effect:"light","open-delay":300,placement:"top"}},[e("nuxt-link",{staticClass:"edit btn-link btn-neutral",attrs:{to:{name:"transaction-edit___"+t.$i18n.locale,params:{transaction_id:n.row.sk,amount:n.row.amount,description:n.row.description,category_id:n.row.category_id,tags:n.row.tags}},type:"warning",size:"sm",icon:""}},[e("i",{staticClass:"tim-icons icon-pencil"})])],1),t._v(" "),e("el-tooltip",{attrs:{content:t.$t("transaction.get.delete"),effect:"light","open-delay":300,placement:"top"}},[e("base-button",{staticClass:"remove btn-link",attrs:{type:"danger",size:"sm",icon:""},nativeOn:{click:function(e){return t.handleDelete(n.row)}}},[e("i",{staticClass:"tim-icons icon-simple-remove"})])],1)],1)}}])})],2)],1),t._v(" "),e("div",{staticClass:"col-12 d-flex justify-content-center justify-content-sm-between flex-wrap",attrs:{slot:"footer"},slot:"footer"},[e("div",{},[e("p",{staticClass:"card-category"},[t._v("\n                    Showing "+t._s(t.from+1)+" to "+t._s(t.to)+" of "+t._s(t.total)+" entries\n                ")])]),t._v(" "),e("base-pagination",{staticClass:"pagination-no-border",attrs:{"per-page":t.pagination.perPage,total:t.total},model:{value:t.pagination.currentPage,callback:function(e){t.$set(t.pagination,"currentPage",e)},expression:"pagination.currentPage"}})],1)])],1)}),[],!1,null,null,null),R={name:"transactions",components:{DisplayTransactions:component.exports}},A=Object(S.a)(R,(function(){var t=this._self._c;return t("div",{staticClass:"content"},[t("div",{staticClass:"row"},[t("div",{staticClass:"col-12"},[t("display-transactions")],1)])])}),[],!1,null,null,null);e.default=A.exports}}]);